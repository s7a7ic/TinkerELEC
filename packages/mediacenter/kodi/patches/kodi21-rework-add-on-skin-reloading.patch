Issue: https://github.com/xbmc/xbmc/issues/27552
From aa70faf3729d2f51539c1c094aac79cc7f761fb5 Mon Sep 17 00:00:00 2001
From: Sebastiiii <sebastiii@team-mediaportal.com>
Date: Sat, 6 Dec 2025 19:38:08 +0100
Subject: [PATCH 1/2] Rework add-on Skin reloading

---
 xbmc/application/ApplicationSkinHandling.cpp |  3 +++
 xbmc/application/ApplicationSkinHandling.h   | 17 +++++++++++++++++
 xbmc/guilib/GUIWindow.cpp                    | 13 ++++++++++++-
 3 files changed, 32 insertions(+), 1 deletion(-)

diff --git a/xbmc/application/ApplicationSkinHandling.cpp b/xbmc/application/ApplicationSkinHandling.cpp
index 4c68cab9d7..72d6940d44 100644
--- a/xbmc/application/ApplicationSkinHandling.cpp
+++ b/xbmc/application/ApplicationSkinHandling.cpp
@@ -397,6 +397,9 @@ void CApplicationSkinHandling::ReloadSkin(bool confirm)
   std::string newSkin = settings->GetString(CSettings::SETTING_LOOKANDFEEL_SKIN);
   if (LoadSkin(newSkin))
   {
+    // We ask the running OnAction loops to stop after this call
+    RequestStopActionPropagation();
+
     /* The Reset() or SetString() below will cause recursion, so the m_confirmSkinChange boolean is set so as to not prompt the
        user as to whether they want to keep the current skin. */
     if (confirm && m_confirmSkinChange)
diff --git a/xbmc/application/ApplicationSkinHandling.h b/xbmc/application/ApplicationSkinHandling.h
index fc5c3d0df5..9144ee7cfa 100644
--- a/xbmc/application/ApplicationSkinHandling.h
+++ b/xbmc/application/ApplicationSkinHandling.h
@@ -34,6 +34,21 @@
   bool OnSettingChanged(const CSetting& setting);
   void ReloadSkin(bool confirm = false);
 
+  // called from GUIWindow::OnAction
+  bool ShouldStopActionPropagation() const
+  {
+    // We read it and then set it back to false for next time
+    if (m_stopActionPropagation)
+    {
+      m_stopActionPropagation = false;
+      return true;
+    }
+    return false;
+  }
+
+  // called from ReloadSkinn
+  void RequestStopActionPropagation() { m_stopActionPropagation = true; }
+
 protected:
   bool LoadSkin(const std::string& skinID);
   bool LoadCustomWindows();
@@ -50,4 +65,6 @@
   IMsgTargetCallback* m_msgCb;
   IWindowManagerCallback* m_wCb;
   bool& m_bInitializing;
+
+  mutable bool m_stopActionPropagation{false};
 };
diff --git a/xbmc/guilib/GUIWindow.cpp b/xbmc/guilib/GUIWindow.cpp
index 8a6f8df687..feeee63d29 100644
--- a/xbmc/guilib/GUIWindow.cpp
+++ b/xbmc/guilib/GUIWindow.cpp
@@ -33,6 +33,8 @@
 #include "utils/log.h"
 
 #include <mutex>
+#include "application/ApplicationComponents.h"
+#include "application/ApplicationSkinHandling.h"
 
 using namespace KODI;
 
@@ -421,6 +423,10 @@
   if (action.IsMouse() || action.IsGesture())
     return EVENT_RESULT_UNHANDLED != OnMouseAction(action);
 
+  // Retrieve the skin manager ONCE
+  const auto& components = CServiceBroker::GetAppComponents();
+  auto skinHandling = components.GetComponent<CApplicationSkinHandling>();
+
   CGUIControl *focusedControl = GetFocusedControl();
   if (focusedControl)
   {
@@ -429,6 +435,10 @@
       if (focusedControl->OnAction(action))
         return true;
       focusedControl = focusedControl->GetParentControl();
+
+      // If a skin reload has just occurred, we stop going back up the chain
+      if (skinHandling && skinHandling->ShouldStopActionPropagation())
+        break;
     }
   }
   else
@@ -812,6 +822,7 @@
 
 void CGUIWindow::ClearAll()
 {
+  ResetControlStates();
   OnWindowUnload();
   CGUIControlGroup::ClearAll();
   m_windowLoaded = false;

