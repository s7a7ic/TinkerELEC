From f3ce0dc8708fd3c0e867d9ff6ae58b0bb52d5e8d Mon Sep 17 00:00:00 2001
From: Philip Langdale <philipl@overt.org>
Date: Thu, 22 Sep 2022 20:05:14 -0700
Subject: [PATCH] vadumpcaps: handle drivers that don't return any drm format
 modifiers

The AMD vaapi driver is one particular example.

Fixes #4.
---
 vadumpcaps.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/vadumpcaps.c b/vadumpcaps.c
index 1f7a031..3f8fb00 100644
--- a/vadumpcaps.c
+++ b/vadumpcaps.c
@@ -1124,8 +1124,9 @@ static void dump_surface_attributes(VADisplay display,
                     const VADRMFormatModifierList *fml =
                         attr_list[i].value.value.p;
                     start_array("drm_format_modifiers");
-                    for (int j = 0; j < fml->num_modifiers; j++)
-                        print_integer(NULL, fml->modifiers[j]);
+                    if (fml)
+                        for (int j = 0; j < fml->num_modifiers; j++)
+                            print_integer(NULL, fml->modifiers[j]);
                     end_array();
                 }
                 break;
