From 0540045bc3e158589b836621ae3aa67f141cdcd2 Mon Sep 17 00:00:00 2001
From: Nick Xie <nick@khadas.com>
Date: Mon, 2 Feb 2026 11:33:10 +0800
Subject: [PATCH 95/99] WIP: arm64: dts: amlogic: meson-s4: add gpu support

Signed-off-by: Nick Xie <nick@khadas.com>
---
 arch/arm64/boot/dts/amlogic/meson-s4.dtsi | 54 +++++++++++++++++++++++
 1 file changed, 54 insertions(+)

diff --git a/arch/arm64/boot/dts/amlogic/meson-s4.dtsi b/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
index 1e9a7d885534..5e5910c01da3 100644
--- a/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
@@ -102,6 +102,39 @@ saradc: adc@fe026000 {
 		status = "disabled";
 	};
 
+	gpu_opp_table: opp-table-gpu {
+		compatible = "operating-points-v2";
+
+		opp-124999998 {
+			opp-hz = /bits/ 64 <124999998>;
+			opp-microvolt = <800000>;
+		};
+		opp-249999996 {
+			opp-hz = /bits/ 64 <249999996>;
+			opp-microvolt = <800000>;
+		};
+		opp-285714281 {
+			opp-hz = /bits/ 64 <285714281>;
+			opp-microvolt = <800000>;
+		};
+		opp-399999994 {
+			opp-hz = /bits/ 64 <399999994>;
+			opp-microvolt = <800000>;
+		};
+		opp-499999992 {
+			opp-hz = /bits/ 64 <499999992>;
+			opp-microvolt = <800000>;
+		};
+		opp-666666656 {
+			opp-hz = /bits/ 64 <666666656>;
+			opp-microvolt = <800000>;
+		};
+		opp-799999987 {
+			opp-hz = /bits/ 64 <799999987>;
+			opp-microvolt = <800000>;
+		};
+	};
+
 	soc {
 		compatible = "simple-bus";
 		#address-cells = <2>;
@@ -993,6 +1026,27 @@ emmc: mmc@fe08c000 {
 			assigned-clock-rates = <24000000>;
 		};
 
+		gpu: gpu@fe400000 {
+			compatible = "amlogic,meson-s4-mali";
+			reg = <0x00 0xfe400000 0x00 0x40000>;
+
+			interrupt-parent = <&gic>;
+			interrupts = <GIC_SPI 146 IRQ_TYPE_LEVEL_HIGH>,
+						<GIC_SPI 145 IRQ_TYPE_LEVEL_HIGH>,
+						<GIC_SPI 144 IRQ_TYPE_LEVEL_HIGH>;
+			interrupt-names = "job", "mmu", "gpu";
+
+			clocks = <&clkc_periphs CLKID_MALI_SEL>,
+					<&clkc_periphs CLKID_MALI>;
+			clock-names = "core", "bus";
+
+			resets = <&reset RESET_MALI>,
+					<&reset RESET_MALI_APB>;
+
+			operating-points-v2 = <&gpu_opp_table>;
+			#cooling-cells = <2>;
+		};
+
 		usb: usb@fe03a000 {
 			compatible = "amlogic,meson-g12a-usb-ctrl";
 			reg = <0x0 0xfe03a000 0x0 0xa0>;
-- 
2.43.0

