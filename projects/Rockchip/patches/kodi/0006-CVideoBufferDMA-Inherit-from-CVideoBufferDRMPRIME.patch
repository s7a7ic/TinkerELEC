From 808aaf9a6aa11cd2b60ad605de7669eaba73e54f Mon Sep 17 00:00:00 2001
From: Jonas Karlman <jonas@kwiboo.se>
Date: Mon, 15 Dec 2025 18:03:33 +0000
Subject: [PATCH 06/10] CVideoBufferDMA: Inherit from CVideoBufferDRMPRIME

---
 xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp     | 2 +-
 xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h       | 6 +++---
 xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp | 1 -
 3 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp
index 3e6bf0dc7a..de3d596afb 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp
@@ -20,7 +20,7 @@ extern "C"
 }
 
 CVideoBufferDMA::CVideoBufferDMA(IVideoBufferPool& pool, int id, uint32_t fourcc, uint64_t size)
-  : CVideoBufferDRMPRIMEFFmpeg(pool, id),
+  : CVideoBufferDRMPRIME(id),
     m_bo(CBufferObject::GetBufferObject(true)),
     m_fourcc(fourcc),
     m_size(size)
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h
index 94eb1c8a16..2f4737e8d1 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h
@@ -14,18 +14,18 @@
 
 class IBufferObject;
 
-class CVideoBufferDMA : public CVideoBufferDRMPRIMEFFmpeg
+class CVideoBufferDMA : public CVideoBufferDRMPRIME
 {
 public:
   CVideoBufferDMA(IVideoBufferPool& pool, int id, uint32_t fourcc, uint64_t size);
   ~CVideoBufferDMA() override;
 
-  // implementation of CVideoBufferDRMPRIME via CVideoBufferDRMPRIMEFFmpeg
+  // implementation of CVideoBufferDRMPRIME via CVideoBufferDRMPRIME
   uint32_t GetWidth() const override { return m_width; }
   uint32_t GetHeight() const override { return m_height; }
   AVDRMFrameDescriptor* GetDescriptor() const override;
 
-  // implementation of CVideoBuffer via CVideoBufferDRMPRIMEFFmpeg
+  // implementation of CVideoBuffer via CVideoBufferDRMPRIME
   void GetPlanes(uint8_t* (&planes)[YuvImage::MAX_PLANES]) override;
   void GetStrides(int (&strides)[YuvImage::MAX_PLANES]) override;
   uint8_t* GetMemPtr() override;
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp b/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp
index b3fcc21167..eba082ae78 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp
@@ -63,7 +63,6 @@ void CVideoBufferPoolDMA::Return(int id)
 {
   std::unique_lock lock(m_critSection);
 
-  m_all[id]->Unref();
   auto it = m_used.begin();
   while (it != m_used.end())
   {
-- 
2.34.1

