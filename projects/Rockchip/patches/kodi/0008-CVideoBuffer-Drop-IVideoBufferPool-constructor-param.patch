From ce40d6c056abb609c0ef05ce5f80800e80de1cef Mon Sep 17 00:00:00 2001
From: Jonas Karlman <jonas@kwiboo.se>
Date: Mon, 15 Dec 2025 18:20:58 +0000
Subject: [PATCH 08/10] CVideoBuffer: Drop IVideoBufferPool constructor
 parameter

---
 xbmc/cores/VideoPlayer/Buffers/VideoBuffer.cpp              | 4 ++--
 xbmc/cores/VideoPlayer/Buffers/VideoBuffer.h                | 2 +-
 xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp           | 2 +-
 xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h             | 2 +-
 xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.cpp      | 4 ++--
 xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.h        | 2 +-
 xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp       | 2 +-
 .../VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp     | 6 +++---
 xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.cpp              | 4 ++--
 xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.h                | 2 +-
 10 files changed, 15 insertions(+), 15 deletions(-)

diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.cpp b/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.cpp
index d5f8a7e870..c526763083 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.cpp
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.cpp
@@ -173,7 +173,7 @@ bool CVideoBuffer::CopyYUV422PackedPicture(YuvImage* pDst, YuvImage *pSrc)
   return true;
 }
 
-CVideoBufferSysMem::CVideoBufferSysMem(IVideoBufferPool &pool, int id, AVPixelFormat format, int size)
+CVideoBufferSysMem::CVideoBufferSysMem(int id, AVPixelFormat format, int size)
 : CVideoBuffer(id)
 {
   m_pixFormat = format;
@@ -313,7 +313,7 @@ CVideoBuffer* CVideoBufferPoolSysMem::Get()
   else
   {
     int id = m_all.size();
-    buf = new CVideoBufferSysMem(*this, id, m_pixFormat, m_size);
+    buf = new CVideoBufferSysMem(id, m_pixFormat, m_size);
     buf->Alloc();
     m_all.push_back(buf);
     m_used.push_back(id);
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.h b/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.h
index db6b5d742f..0dc04b9a24 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.h
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBuffer.h
@@ -120,7 +120,7 @@ protected:
 class CVideoBufferSysMem : public CVideoBuffer
 {
 public:
-  CVideoBufferSysMem(IVideoBufferPool &pool, int id, AVPixelFormat format, int size);
+  CVideoBufferSysMem(int id, AVPixelFormat format, int size);
   ~CVideoBufferSysMem() override;
   uint8_t* GetMemPtr() override;
   void GetPlanes(uint8_t*(&planes)[YuvImage::MAX_PLANES]) override;
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp
index de3d596afb..170add691d 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.cpp
@@ -19,7 +19,7 @@ extern "C"
 #include <libavutil/pixdesc.h>
 }
 
-CVideoBufferDMA::CVideoBufferDMA(IVideoBufferPool& pool, int id, uint32_t fourcc, uint64_t size)
+CVideoBufferDMA::CVideoBufferDMA(int id, uint32_t fourcc, uint64_t size)
   : CVideoBufferDRMPRIME(id),
     m_bo(CBufferObject::GetBufferObject(true)),
     m_fourcc(fourcc),
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h
index 2f4737e8d1..f974f636ea 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDMA.h
@@ -17,7 +17,7 @@ class IBufferObject;
 class CVideoBufferDMA : public CVideoBufferDRMPRIME
 {
 public:
-  CVideoBufferDMA(IVideoBufferPool& pool, int id, uint32_t fourcc, uint64_t size);
+  CVideoBufferDMA(int id, uint32_t fourcc, uint64_t size);
   ~CVideoBufferDMA() override;
 
   // implementation of CVideoBufferDRMPRIME via CVideoBufferDRMPRIME
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.cpp b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.cpp
index f289ea2320..50a1a7b4cb 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.cpp
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.cpp
@@ -94,7 +94,7 @@ CVideoBufferDRMPRIME::CVideoBufferDRMPRIME(int id) : CVideoBuffer(id)
   m_pixFormat = AV_PIX_FMT_DRM_PRIME;
 }
 
-CVideoBufferDRMPRIMEFFmpeg::CVideoBufferDRMPRIMEFFmpeg(IVideoBufferPool& pool, int id)
+CVideoBufferDRMPRIMEFFmpeg::CVideoBufferDRMPRIMEFFmpeg(int id)
   : CVideoBufferDRMPRIME(id)
 {
   m_pFrame = av_frame_alloc();
@@ -181,7 +181,7 @@ CVideoBuffer* CVideoBufferPoolDRMPRIMEFFmpeg::Get()
   else
   {
     int id = m_all.size();
-    buf = new CVideoBufferDRMPRIMEFFmpeg(*this, id);
+    buf = new CVideoBufferDRMPRIMEFFmpeg(id);
     m_all.push_back(buf);
     m_used.push_back(id);
   }
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.h b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.h
index 777253ab62..78c9ad1f00 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.h
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferDRMPRIME.h
@@ -72,7 +72,7 @@ protected:
 class CVideoBufferDRMPRIMEFFmpeg : public CVideoBufferDRMPRIME
 {
 public:
-  CVideoBufferDRMPRIMEFFmpeg(IVideoBufferPool& pool, int id);
+  CVideoBufferDRMPRIMEFFmpeg(int id);
   ~CVideoBufferDRMPRIMEFFmpeg() override;
   void SetRef(AVFrame* frame);
   void Unref();
diff --git a/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp b/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp
index eba082ae78..34147b0a34 100644
--- a/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp
+++ b/xbmc/cores/VideoPlayer/Buffers/VideoBufferPoolDMA.cpp
@@ -43,7 +43,7 @@ CVideoBuffer* CVideoBufferPoolDMA::Get()
   else
   {
     int id = m_all.size();
-    buf = new CVideoBufferDMA(*this, id, m_fourcc, m_size);
+    buf = new CVideoBufferDMA(id, m_fourcc, m_size);
 
     if (!buf->Alloc())
     {
diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp b/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp
index 737ce43d36..cebe57036c 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp
@@ -73,7 +73,7 @@ enum EFilterFlags {
 class CVideoBufferFFmpeg : public CVideoBuffer
 {
 public:
-  CVideoBufferFFmpeg(IVideoBufferPool &pool, int id);
+  CVideoBufferFFmpeg(int id);
   ~CVideoBufferFFmpeg() override;
   void GetPlanes(uint8_t*(&planes)[YuvImage::MAX_PLANES]) override;
   void GetStrides(int(&strides)[YuvImage::MAX_PLANES]) override;
@@ -85,7 +85,7 @@ protected:
   AVFrame* m_pFrame;
 };
 
-CVideoBufferFFmpeg::CVideoBufferFFmpeg(IVideoBufferPool &pool, int id)
+CVideoBufferFFmpeg::CVideoBufferFFmpeg(int id)
 : CVideoBuffer(id)
 {
   m_pFrame = av_frame_alloc();
@@ -161,7 +161,7 @@ CVideoBuffer* CVideoBufferPoolFFmpeg::Get()
   else
   {
     int id = m_all.size();
-    buf = new CVideoBufferFFmpeg(*this, id);
+    buf = new CVideoBufferFFmpeg(id);
     m_all.push_back(buf);
     m_used.push_back(id);
   }
diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.cpp b/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.cpp
index b6438be735..0d08aa0f2b 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.cpp
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.cpp
@@ -28,7 +28,7 @@ using namespace VTB;
 // Video Buffers
 //------------------------------------------------------------------------------
 
-CVideoBufferVTB::CVideoBufferVTB(IVideoBufferPool &pool, int id)
+CVideoBufferVTB::CVideoBufferVTB(int id)
 : CVideoBuffer(id)
 {
   m_pFrame = av_frame_alloc();
@@ -95,7 +95,7 @@ CVideoBuffer* CVideoBufferPoolVTB::Get()
   else
   {
     int id = m_all.size();
-    buf = new CVideoBufferVTB(*this, id);
+    buf = new CVideoBufferVTB(id);
     m_all.push_back(buf);
     m_used.push_back(id);
   }
diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.h b/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.h
index 726d6801ee..289df2dd2f 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.h
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Video/VTB.h
@@ -30,7 +30,7 @@ class CVideoBufferPoolVTB;
 class CVideoBufferVTB: public CVideoBuffer
 {
 public:
-  CVideoBufferVTB(IVideoBufferPool &pool, int id);
+  CVideoBufferVTB(int id);
   ~CVideoBufferVTB() override;
   void SetRef(AVFrame *frame);
   void Unref();
-- 
2.34.1

